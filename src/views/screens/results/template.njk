{% extends "layout/template.njk" %}

{% from "partials/quick_search/macro.njk" import quickSearch %}
{% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}

{% block beforeContent %}
  {{ super() }}
  {{ govukBreadcrumbs({
    items: [
      {
        text: "Home",
        href: homePageUrl
      },
      {
        text: "Search results",
        href: "#"
      }
    ]
  }) }}
{% endblock %}

{% block content %}

  {{ quickSearch({
    isResultPage: true,
    searchTerm: searchTerm,
    searchInputError : searchInputError
  }) }}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-one-third">
      <p>&nbsp;</p>
    </div>
    <div class="govuk-grid-column-two-thirds">
      <div class="govuk-section-break--visible">
        <h2 class="govuk-heading-m">{%- if searchResults.hits.total.value > 0 -%} {{searchResults.hits.total.value}} results {%- else -%} 0 results found {%- endif -%}</h2>
      </div>
      {%- if hasResult == true -%}
      {%- if searchResults.hits.total.value > 0 -%}
      {% for item in searchResults.hits.hits %}
        <div class="govuk-section-break--visible">
          <h2 class="govuk-heading-m">{{item._source.resourceTitleObject.default}}</h2>
          <p class="govuk-caption-m govuk-!-font-size-14">
            <b>Published by</b>
            <span class="govuk-!-padding-left-5">
              {% if item._source.contact|length > 0 %}
              {{item._source.contact[0].organisationObject.default}}
              {% endif %}
            </span></p>
          <p class="govuk-caption-m govuk-!-font-size-14">
            <b>Study period</b>
            <span class="govuk-!-padding-left-5">
              {% if item._source.resourceTemporalExtentDetails|length > 0 %}
              {{item._source.resourceTemporalExtentDetails[0].start.date | date("DD MMM YYYY")}} to {{item._source.resourceTemporalExtentDetails[0].end.date | date("DD MMM YYYY")}}
              {% endif %}
            </span></p>
          <p class="govuk-body">{{item._source.resourceAbstractObject.default}}</p>
          <button type="submit" class="govuk-button govuk-button--primary" data-module="govuk-button">
          Open data
        </button>
          <button type="submit" class="govuk-button govuk-button--secondary" data-module="govuk-button">
          More info
        </button>
        </div>
      {% endfor %}
      {%- else -%}
        <p class="govuk-heading-m">There are no matching results</p>
        <p class="govuk-caption-m govuk-!-font-size-14">Search with different keywords.</p>
      {%- endif -%}
      {%- else -%}
        <p class="govuk-caption-m govuk-!-font-size-14">Unable to fetch the search results. Please try again.</p>
      {%- endif -%}

    </div>
  </div>
{% endblock %}